{% macro route_display(route=None) %}
<details class="govuk-details redbox-message-route" {% if not route %} hidden {% endif %}>
  <summary class="govuk-details__summary">
    <span class="govuk-details__summary-text govuk-!-font-size-16">
      Response generated using @<span class="route-text">{{ route }}</span>
    </span>
  </summary>
  <div class="govuk-details__text govuk-!-font-size-16">
    <span>Redbox uses different paths to generate the best response</span>
    <ul>
      <li>I can @chat about general questions, not related
        to your documents</li>
      <li>I can @summarise over selected documents and
        do Q&amp;A on them, extract information, summarise and more!</li>
      <li>I can help you @search over selected documents and
        do Q&amp;A on them, with citations</li>
      <li>I can use agents to search on GOV.UK and Wikipedia using the @gadget command, with citations</li>
    </ul>
  </div>
</details>
{% endmacro %}



{% macro message_box(message) %}


{% set role_text = message.role %}
{% if message.role == "ai" %}
{% set role_text = "Redbox" %}
{% elif message.role == "user" %}
{% set role_text = "You" %}
{% endif %}


<div
  class="govuk-inset-text {% if message.role == "user" %} govuk-inset-text-right {% endif %} govuk-body"
  data-role="{{ message.role }}" tabindex="-1" id="chat-message-{{ message.id }}">

  <markdown-converter class="iai-chat-bubble__text">{{ message.text }}</markdown-converter>
  {% if message.unique_citation_uris() %}
  <h3 class="iai-chat-bubble__sources-heading govuk-heading-s govuk-!-margin-bottom-1">Sources</h3>
  <div class="iai-display-flex-from-desktop">
    <ol class="rb-footnote-list govuk-!-margin-bottom-0">
      {% for display, href, cit_id, text_in_answer in message.unique_citation_uris() %}
        <li class="govuk-!-margin-bottom-0">
          <a class="iai-chat-bubbles__sources-link govuk-link" id="footnote-{{ message.id }}-{{ loop.index }}" href="{{ href }}" target="_blank">{{ display }}</a>
        </li>
      {% endfor %}
    </ol>
  </div>
  <br />
  {% endif %}
</div>

<div class="iai-chat-bubble__header">
  {% if message.route %}
  {{ route_display(message.route) }}
  {% endif %}
</div>


{% if message.role == "ai" %}

<div class="chat-actions-container">
  <feedback-buttons data-id="{{ message.id }}"></feedback-buttons>
  <copy-text data-id="{{ message.id}}"></copy-text>
</div>

{% endif %}
{% endmacro %}
